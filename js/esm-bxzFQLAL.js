import { V as Vec2, a as Vec3, Q as Quat, C as Color, S as Script, W as WasmModule } from './index.mjs';

function _define_property$a(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Constants{}_define_property$a(Constants,"EPS",1e-5);_define_property$a(Constants,"EPS2",Constants.EPS*Constants.EPS);_define_property$a(Constants,"INF",1e30);_define_property$a(Constants,"Deg2Rad",Math.PI/180);_define_property$a(Constants,"Rad2Deg",57.29578);_define_property$a(Constants,"DEBUG_DRAW_MIN_LENGTH",.1);_define_property$a(Constants,"BODY_DEFAULT_FRICTION",.5);_define_property$a(Constants,"CHARACTER_GROUND_DAMPING",5);_define_property$a(Constants,"CHARACTER_MAX_SPEED",20);

var constants = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Constants: Constants
});

function _define_property$9(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Transform2D{clone(){var ret=new Transform2D;ret.copy(this);return ret}copy(rhs){this.p=rhs.p;this.q=rhs.q;return this}transformPointVec(p){return this.transformPoint(p.x,p.y)}transformPoint(px,py){var x=this.q.x*px-this.q.y*py+this.p.x;var y=this.q.y*px+this.q.x*py+this.p.y;return new Vec2(x,y)}invTransformPointVec(p){return this.invTransformPoint(p.x,p.y)}invTransformPoint(px,py){var vx=px-this.p.x;var vy=py-this.p.y;var x=this.q.x*vx+this.q.y*vy;var y=-this.q.y*vx+this.q.x*vy;return new Vec2(x,y)}transformDirectionVec(d){return this.transformDirection(d.x,d.y)}transformDirection(dx,dy){var x=this.q.x*dx-this.q.y*dy;var y=this.q.y*dx+this.q.x*dy;return new Vec2(x,y)}invTransformDirectionVec(d){return this.invTransformDirection(d.x,d.y)}invTransformDirection(dx,dy){var x=this.q.x*dx+this.q.y*dy;var y=-this.q.y*dx+this.q.x*dy;return new Vec2(x,y)}constructor(position,rotation=0){this.p=position.clone();var angle=rotation*Constants.Deg2Rad;this.q=new Vec2(Math.cos(angle),Math.sin(angle));}}_define_property$9(Transform2D,"IDENTITY",Object.freeze(new Transform2D(Vec2.ZERO,0)));

var transform2d = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Transform2D: Transform2D
});

class ShapeType{}(()=>{ShapeType.CIRCLE=0;ShapeType.CAPSULE=1;ShapeType.SEGMENT=2;ShapeType.POLYGON=3;})();

var shape_type = /*#__PURE__*/Object.freeze({
    __proto__: null,
    ShapeType: ShapeType
});

class Utils{static clampMagnitudeVec2(v,maxLength){var len2=v.lengthSq();if(len2>maxLength*maxLength){var ratio=maxLength/Math.sqrt(len2);return new Vec2(v.x*ratio,v.y*ratio)}return v}static clampMagnitudeVec2InPlace(v,x,y,maxLength){var len2=x*x+y*y;if(len2>maxLength*maxLength){var ratio=maxLength/Math.sqrt(len2);v.set(x*ratio,y*ratio);return}v.set(x,y);}static normalizeVec2(v){var len2=v.lengthSq();if(len2<Constants.EPS2){return Vec2.ZERO.clone()}var len=Math.sqrt(len2);return new Vec2(v.x/len,v.y/len)}static normalizeVec2InPlace(v){var len2=v.lengthSq();if(len2<Constants.EPS2){v.set(0,0);return}v.divScalar(Math.sqrt(len2));}static moveTowards(current,target,maxDelta){var delta=target-current;if(Math.abs(delta)<=maxDelta){return target}if(target<current)return current-maxDelta;else return current+maxDelta}static distanceSqrVec2(a,b){const x=a.x-b.x;const y=a.y-b.y;return x*x+y*y}static distanceSqrVec3(a,b){const x=a.x-b.x;const y=a.y-b.y;const z=a.z-b.z;return x*x+y*y+z*z}static isZero(v){return Math.abs(v)<Constants.EPS}static isZeroVec2(v){return v.lengthSq()<Constants.EPS2}static isZeroVec3(v){return v.lengthSq()<Constants.EPS2}static isZeroQuat(q){return q.x*q.x+q.y*q.y+q.z*q.z<Constants.EPS2}static equalVec2(a,b){return Utils.distanceSqrVec2(a,b)<Constants.EPS2}static equalVec3(a,b){return Utils.distanceSqrVec3(a,b)<Constants.EPS2}static equal(a,b){return Math.abs(a-b)<Constants.EPS}static notEqual(a,b){return Math.abs(a-b)>Constants.EPS}static less(a,b){return a<b-Constants.EPS}static lessOrEqual(a,b){return a<b+Constants.EPS}static greater(a,b){return a>b+Constants.EPS}static greaterOrEqual(a,b){return a>b-Constants.EPS}static getPosition3D(position,height=0){return new Vec3(position.x,height,position.y)}static getPosition2D(position3D){return new Vec2(position3D.x,position3D.z)}static normalizeOrientation(orientation){orientation%=360;if(orientation<0)orientation+=360;if(Utils.equal(orientation,360))orientation=0;return orientation}static getOrientationFromDirection(direction,defaultOrientation=0){if(Utils.isZeroVec2(direction)){return defaultOrientation}return Math.atan2(direction.y,direction.x)*Constants.Rad2Deg}static getDirectionFromOrientation(orientation){var angle=orientation*Constants.Deg2Rad;return new Vec2(Math.cos(angle),Math.sin(angle))}static getRotationFromOrientation(orientation){return new Quat().setFromAxisAngle(Vec3.UP,90-orientation)}}

var utils = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Utils: Utils
});

function _define_property$8(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Box2DUtils{static setup(){Box2DUtils.b2Vec2_ZERO=new Box2D.b2Vec2(0,0);Box2DUtils.b2Rot_IDENTITY=Box2DUtils.b2Rot_create(1,0);Box2DUtils.b2Transform_IDENTITY=new Box2D.b2Transform(Box2DUtils.b2Vec2_ZERO,Box2DUtils.b2Rot_IDENTITY);}static b2Vec2_toPC(v){return new Vec2(v.get_x(),v.get_y())}static b2Vec2_create(x,y){return new Box2D.b2Vec2(x,y)}static b2Vec2_fromPC(v){return new Box2D.b2Vec2(v.x,v.y)}static b2Rot_create(c,s){var rot=new Box2D.b2Rot;rot.set_c(c);rot.set_s(s);return rot}static b2Rot_fromPC(v){var rot=new Box2D.b2Rot;rot.set_c(v.x);rot.set_s(v.y);return rot}static b2Transform_create(position,rotation){return new Box2D.b2Transform(Box2DUtils.b2Vec2_fromPC(position),new Box2D.b2Rot(rotation))}static b2Transform_fromPC(transform){var ret=new Box2D.b2Transform;ret.set_p(Box2DUtils.b2Vec2_fromPC(transform.p));ret.set_q(Box2DUtils.b2Vec2_fromPC(transform.q));return ret}static b2Color_toPC(color){var col=Box2D.wrapPointer(color,Box2D.b2Color);var r=col.get_r();var g=col.get_g();var b=col.get_b();return new Color(r,g,b)}}_define_property$8(Box2DUtils,"b2DrawFlag_shapeBit",1);_define_property$8(Box2DUtils,"b2DrawFlag_jointBit",2);_define_property$8(Box2DUtils,"b2DrawFlag_aabbBit",4);_define_property$8(Box2DUtils,"b2DrawFlag_pairBit",8);_define_property$8(Box2DUtils,"b2DrawFlag_centerOfMassBit",16);_define_property$8(Box2DUtils,"b2ShapeType_circle",0);_define_property$8(Box2DUtils,"b2ShapeType_edge",1);_define_property$8(Box2DUtils,"b2ShapeType_polygon",2);_define_property$8(Box2DUtils,"b2ShapeType_chain",3);_define_property$8(Box2DUtils,"b2ShapeType_typeCount",4);_define_property$8(Box2DUtils,"b2Vec2_ZERO",undefined);_define_property$8(Box2DUtils,"b2Rot_IDENTITY",undefined);_define_property$8(Box2DUtils,"b2Transform_IDENTITY",undefined);

var box2d_utils = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Box2DUtils: Box2DUtils
});

function _define_property$7(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Game extends Script{initialize(){Game.instance=this;Game.isReady=false;this.world=null;this.joystick=this.joystickEntity?this.joystickEntity.script.joystick:null;this.gameCamera=this.gameCameraEntity?this.gameCameraEntity.script.gameCamera:null;this.move=Vec2.ZERO.clone();this.characters=[];this.player=null;this.characterCount=0;this.characterCap=0;this.moveLeft=false;this.moveRight=false;this.moveUp=false;this.moveRight=false;this.app.on("move:left",val=>{this.moveLeft=val;});this.app.on("move:right",val=>{this.moveRight=val;});this.app.on("move:up",val=>{this.moveUp=val;});this.app.on("move:down",val=>{this.moveDown=val;});this.onBox2DDrawSegment=this.onBox2DDrawSegment.bind(this);this.onBox2DDrawPolygon=this.onBox2DDrawPolygon.bind(this);this.onBox2DDrawSolidPolygon=this.onBox2DDrawSolidPolygon.bind(this);this.onBox2DDrawCircle=this.onBox2DDrawCircle.bind(this);this.onBox2DDrawSolidCircle=this.onBox2DDrawSolidCircle.bind(this);this.onBox2DDrawTransform=this.onBox2DDrawTransform.bind(this);this.onBox2DLoaded=this.onBox2DLoaded.bind(this);WasmModule.getInstance("Box2D",this.onBox2DLoaded);}static getWorld(){if(!Game.isReady)return null;return Game.instance.world}static getMove(){if(!Game.isReady)return Vec2.ZERO;return Game.instance.move}addBox2DDebugSegment(p1,p2,color){color=new Color(1,0,0);this.box2DDebugSegments.push({"start":p1,"end":p2,"color":color});}addBox2DDebugCircle(p,r,color){color=new Color(1,0,0);this.box2DDebugCircles.push({"center":p,"radius":r,"color":color});}onBox2DDrawSegment(_p1,_p2,_color){var p1=Box2DUtils.b2Vec2_toPC(Box2D.wrapPointer(_p1,Box2D.b2Vec2));var p2=Box2DUtils.b2Vec2_toPC(Box2D.wrapPointer(_p2,Box2D.b2Vec2));var color=Box2DUtils.b2Color_toPC(_color);this.addBox2DDebugSegment(p1,p2,color);}onBox2DDrawPolygon(_vertices,_vertexCount,_color){if(_vertexCount<2)return;var color=Box2DUtils.b2Color_toPC(_color);var _lastVertex=Box2D.wrapPointer(_vertices,Box2D.b2Vec2);var _startVertex=_lastVertex;var p1,p2;for(var i=1;i<_vertexCount;++i){var _vertex=Box2D.wrapPointer(_vertices+i*8,Box2D.b2Vec2);p1=Box2DUtils.b2Vec2_toPC(_lastVertex);p2=Box2DUtils.b2Vec2_toPC(_vertex);this.addBox2DDebugSegment(p1,p2,color);_lastVertex=_vertex;}p1=Box2DUtils.b2Vec2_toPC(_lastVertex);p2=Box2DUtils.b2Vec2_toPC(_startVertex);this.addBox2DDebugSegment(p1,p2,color);}onBox2DDrawSolidPolygon(_vertices,_vertexCount,_color){this.onBox2DDrawPolygon(_vertices,_vertexCount,_color);}onBox2DDrawCircle(_center,_radius,_color){var center=Box2DUtils.b2Vec2_toPC(Box2D.wrapPointer(_center,Box2D.b2Vec2));var color=Box2DUtils.b2Color_toPC(_color);this.addBox2DDebugCircle(center,_radius,color);}onBox2DDrawSolidCircle(_center,_radius,_axis,_color){this.onBox2DDrawCircle(_center,_radius,_color);}onBox2DDrawTransform(_transform){}onBox2DLoaded(instance){console.log("BOX 2D LOADED!!!");window["Box2D"]=instance;Box2DUtils.setup();this.world=new Box2D.b2World(Box2DUtils.b2Vec2_ZERO);this.box2DDebugSegments=[];this.box2DDebugCircles=[];var debugDraw=new Box2D.JSDraw;debugDraw.DrawSegment=this.onBox2DDrawSegment;debugDraw.DrawPolygon=this.onBox2DDrawPolygon;debugDraw.DrawSolidPolygon=this.onBox2DDrawSolidPolygon;debugDraw.DrawCircle=this.onBox2DDrawCircle;debugDraw.DrawSolidCircle=this.onBox2DDrawSolidCircle;debugDraw.SetFlags(Box2DUtils.b2DrawFlag_shapeBit);this.world.SetDebugDraw(debugDraw);this.loadStaticColliders();}loadStaticColliders(){var asset=this.app.assets.find("colliders.bin","binary");var data=new DataView(asset.resource);var offset=0;var colliderCount=data.getUint16(offset,true);offset+=2;for(var i=0;i<colliderCount;++i){var x=data.getFloat32(offset,true);offset+=4;var y=data.getFloat32(offset,true);offset+=4;var rotation=data.getFloat32(offset,true);offset+=4;var transform=new Transform2D(new Vec2(x,y),-rotation);data.getUint8(offset);offset++;var shapeType=data.getUint8(offset);offset++;switch(shapeType){case ShapeType.SEGMENT:{var x1=data.getFloat32(offset,true);offset+=4;var y1=data.getFloat32(offset,true);offset+=4;var x2=data.getFloat32(offset,true);offset+=4;var y2=data.getFloat32(offset,true);offset+=4;this.addStaticSegmentCollider(transform,new Vec2(x1,y1),new Vec2(x2,y2));}break;case ShapeType.CIRCLE:{var x=data.getFloat32(offset,true);offset+=4;var y=data.getFloat32(offset,true);offset+=4;var radius=data.getFloat32(offset,true);offset+=4;this.addStaticCircleCollider(transform,new Vec2(x,y),radius);}break;case ShapeType.CAPSULE:{var x1=data.getFloat32(offset,true);offset+=4;var y1=data.getFloat32(offset,true);offset+=4;var x2=data.getFloat32(offset,true);offset+=4;var y2=data.getFloat32(offset,true);offset+=4;var radius=data.getFloat32(offset,true);offset+=4;this.addStaticCapsuleCollider(transform,new Vec2(x1,y1),new Vec2(x2,y2),radius);}break;case ShapeType.POLYGON:{var pointCount=data.getUint8(offset);offset++;var points=[];for(var j=0;j<pointCount;++j){var x=data.getFloat32(offset,true);offset+=4;var y=data.getFloat32(offset,true);offset+=4;points.push(new Vec2(x,y));}var radius=data.getFloat32(offset,true);offset+=4;this.addStaticPolygonCollider(transform,points,radius);}break}}}createStaticBody(){var bodyDef=new Box2D.b2BodyDef;bodyDef.set_type(Box2D.b2_staticBody);return this.world.CreateBody(bodyDef)}createStaticFixture(body,shape){var fixtureDef=new Box2D.b2FixtureDef;fixtureDef.set_shape(shape);fixtureDef.set_friction(Constants.BODY_DEFAULT_FRICTION);return body.CreateFixture(fixtureDef)}addStaticSegmentCollider(transform,point1,point2){var body=this.createStaticBody();point1=transform.transformPoint(point1.x,point1.y);point2=transform.transformPoint(point2.x,point2.y);var length=point1.distance(point2);var segmentShape=new Box2D.b2EdgeShape;var p1=new Box2D.b2Vec2(-length*.5,0);var p2=new Box2D.b2Vec2(length*.5,0);segmentShape.Set(p1,p2);this.createStaticFixture(body,segmentShape);var position=new Vec2((point1.x+point2.x)*.5,(point1.y+point2.y)*.5);var rotation=Math.atan2(point2.y-point1.y,point2.x-point1.x);body.SetTransform(Box2DUtils.b2Vec2_fromPC(position),rotation);return body}addStaticCapsuleCollider(transform,center1,center2,radius){var body=this.createStaticBody();center1=transform.transformPoint(center1.x,center1.y);center2=transform.transformPoint(center2.x,center2.y);var length=center1.distance(center2);var capsuleShape=new Box2D.b2EdgeShape;var p1=new Box2D.b2Vec2(-length*.5,0);var p2=new Box2D.b2Vec2(length*.5,0);capsuleShape.Set(p1,p2);capsuleShape.set_m_radius(radius);this.createStaticFixture(body,capsuleShape);var position=new Vec2((center1.x+center2.x)*.5,(center1.y+center2.y)*.5);var rotation=Math.atan2(center2.y-center1.y,center2.x-center1.x);body.SetTransform(Box2DUtils.b2Vec2_fromPC(position),rotation);return body}addStaticCircleCollider(transform,center,radius){var body=this.createStaticBody();center=transform.transformPoint(center.x,center.y);var circleShape=new Box2D.b2CircleShape;circleShape.set_m_radius(radius);circleShape.set_m_p(Box2DUtils.b2Vec2_fromPC(center));this.createStaticFixture(body,circleShape);return body}addStaticPolygonCollider(transform,vertices,radius=0){var body=this.createStaticBody();var vertexCount=vertices.length;var buffer=Box2D._malloc(vertexCount*8);var offset=0;for(var i=0;i<vertexCount;++i){var p=transform.transformPoint(vertices[i].x,vertices[i].y);Box2D.HEAPF32[buffer+offset>>2]=p.x;Box2D.HEAPF32[buffer+(offset+4)>>2]=p.y;offset+=8;}var polygonShape=new Box2D.b2PolygonShape;var ptr_wrapped=Box2D.wrapPointer(buffer,Box2D.b2Vec2);polygonShape.Set(ptr_wrapped,vertexCount);polygonShape.set_m_radius(radius);this.createStaticFixture(body,polygonShape);return body}addStaticAABBCollider(x0,y0,x1,y1){var body=this.createStaticBody();var hx=Math.abs(x1-x0)*.5;var hy=Math.abs(y1-y0)*.5;var cx=(x0+x1)*.5;var cy=(y0+y1)*.5;var polygonShape=new Box2D.b2PolygonShape;polygonShape.SetAsBox(hx,hy,new Box2D.b2Vec2(cx,cy),0);this.createStaticFixture(body,polygonShape);return body}addStaticOBBCollider(center,width,height,angle=0){var body=this.createStaticBody();var hx=width*.5;var hy=height*.5;var polygonShape=new Box2D.b2PolygonShape;polygonShape.SetAsBox(hx,hy);this.createStaticFixture(body,polygonShape);body.SetTransform(Box2DUtils.b2Vec2_fromPC(center),-angle*Constants.Deg2Rad);return body}update(dt){if(!Game.isReady){if(this.world!=null){Game.isReady=true;this.initializeCharacters();}else {return}}this.updateInput(dt);this.updatePhysics(dt);this.updateCharacters(dt);}updatePhysics(dt){this.world.Step(1/60,6,2);}updateInput(dt){this.move.set(0,0);if(this.joystick){this.move.add(this.joystick.move);}if(this.moveUp){this.move.add(Vec2.UP);}if(this.moveDown){this.move.add(Vec2.DOWN);}if(this.moveLeft){this.move.add(Vec2.LEFT);}if(this.moveRight){this.move.add(Vec2.RIGHT);}Utils.normalizeVec2InPlace(this.move);}setPlayer(player){this.player=player;this.gameCamera.setFollowCharacter(player);}registerCharacter(character){if(this.characterCount<this.characterCap){this.characters[this.characterCount++]=character;}else {this.characterCount++;this.characterCap++;this.characters.push(character);}}initializeCharacters(){if(this.characterCount===0)return;for(var i=0;i<this.characterCount;++i){var character=this.characters[i];character.initializeCharacter();}}destroyCharacter(character){}updateCharacters(dt){if(this.characterCount===0)return;var newCharacterCount=0;for(var i=0;i<this.characterCount;++i){var character=this.characters[i];character.updateCharacter(dt);if(character.isValid){this.characters[newCharacterCount++]=character;}else {this.destroyCharacter(character);}}if(newCharacterCount<this.characterCount){for(var i=newCharacterCount;i<this.characterCount;++i){this.characters[i]=null;}this.characterCount=newCharacterCount;}for(var i=0;i<this.characterCount;++i){var character=this.characters[i];character.postUpdateCharacter(dt);}}drawLine(start,end,color){this.app.drawLine(Utils.getPosition3D(start),Utils.getPosition3D(end),color,false);}drawCircle(center,radius,color){var len=2*Math.PI*radius;var segmentCount=Math.ceil(len/Constants.DEBUG_DRAW_MIN_LENGTH);var angle=0;var lastPoint=new Vec2(Math.cos(angle)*radius+center.x,Math.sin(angle)*radius+center.y);var point=new Vec2;for(var i=1;i<=segmentCount;++i){angle=2*Math.PI*i/segmentCount;point.set(Math.cos(angle)*radius+center.x,Math.sin(angle)*radius+center.y);this.drawLine(lastPoint,point,color);lastPoint.copy(point);}}postUpdate(dt){if(!Game.isReady)return;this.world.DrawDebugData();var segmentCount=this.box2DDebugSegments.length;for(var i=0;i<segmentCount;++i){var segment=this.box2DDebugSegments[i];var start=segment.start;var end=segment.end;var color=segment.color;this.drawLine(start,end,color);}var circleCount=this.box2DDebugCircles.length;for(var i=0;i<circleCount;++i){var circle=this.box2DDebugCircles[i];var center=circle.center;var radius=circle.radius;var color=circle.color;this.drawCircle(center,radius,color);}this.box2DDebugSegments.length=0;this.box2DDebugCircles.length=0;}constructor(...args){super(...args);_define_property$7(this,"joystickEntity",void 0);_define_property$7(this,"gameCameraEntity",void 0);}}_define_property$7(Game,"scriptName","game");_define_property$7(Game,"isReady",false);_define_property$7(Game,"instance",null);

var game = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Game: Game
});

function _define_property$6(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Character extends Script{getCharacterType(){return Character.TYPE_UNKNOWN}postInitialize(){Game.instance.registerCharacter(this);}setEnityPosition(p){return this.entity.setLocalPosition(p)}setEnityRotation(r){return this.entity.setLocalRotation(r)}setPosition(p){this.position.copy(p);}getPosition(){return this.position}getEnityPosition(){return this.entity.getLocalPosition()}setVelocity(v){this.velocity.copy(v);}setTargetVelocity(v){this.targetVelocity.copy(v);}setTargetVelocityFromDirection(direction){this.targetVelocity.copy(direction);this.targetVelocity.mulScalar(this.speed);}setOrientation(o){this.orientation=o;}setOrientationFromDirection(direction){this.orientation=Utils.getOrientationFromDirection(direction,this.orientation);}getBodyPosition(){return Box2DUtils.b2Vec2_toPC(this.body.GetPosition())}getBodyVelocity(){return Box2DUtils.b2Vec2_toPC(this.body.GetLinearVelocity())}setBodyVelocity(v){this.body.SetLinearVelocity(Box2DUtils.b2Vec2_fromPC(v));}addBodyVelocity(v){var bodyVelocity=this.getBodyVelocity().add(v);bodyVelocity=Utils.clampMagnitudeVec2(bodyVelocity,Constants.CHARACTER_MAX_SPEED);this.setBodyVelocity(bodyVelocity);}forceVelocity(velocity){this.setVelocity(velocity);this.setBodyVelocity(velocity);}setupPhysics(){var bodyDef=new Box2D.b2BodyDef;bodyDef.set_type(Box2D.b2_dynamicBody);bodyDef.set_linearDamping(Constants.CHARACTER_GROUND_DAMPING);bodyDef.set_fixedRotation(true);this.body=Game.getWorld().CreateBody(bodyDef);var circleShape=new Box2D.b2CircleShape;circleShape.set_m_radius(this.radius);var fixtureDef=new Box2D.b2FixtureDef;fixtureDef.set_shape(circleShape);fixtureDef.set_friction(Constants.BODY_DEFAULT_FRICTION);this.body.CreateFixture(fixtureDef);var massData=new Box2D.b2MassData;massData.set_mass(this.mass);this.body.SetMassData(massData);this.body.SetTransform(Box2DUtils.b2Vec2_fromPC(this.position),0);this.body.SetLinearVelocity(Box2DUtils.b2Vec2_ZERO);}markDestroy(){this.isValid=false;}isAlive(){if(!this.isValid)return false;return this.state!=Character.STATE_DIE}initializeCharacter(){this.isValid=true;this.position=Utils.getPosition2D(this.entity.getPosition());this.orientation=this.entity.getEulerAngles().y;this.velocity=Vec2.ZERO.clone();this.targetVelocity=Vec2.ZERO.clone();this.state=Character.STATE_MOVE;this.prevState=-1;this.health=this.maxHealth;this.setupPhysics();}updateCharacter(dt){this.updatePhysics(dt);this.updateState(dt);this.updateDisplay(dt);}postUpdateCharacter(dt){}updatePhysics(dt){var bodyPosition=this.getBodyPosition();this.setPosition(bodyPosition);var bodyVelocity=Utils.clampMagnitudeVec2(this.getBodyVelocity(),Constants.CHARACTER_MAX_SPEED);if(Utils.isZeroVec2(this.targetVelocity)){if(Utils.isZeroVec2(bodyVelocity)){this.forceVelocity(Vec2.ZERO);}else {var bodySpeed=bodyVelocity.length();var bodyDirection=bodyVelocity.clone().divScalar(bodySpeed);bodySpeed=Math.max(bodySpeed-this.acceleration*dt,0);bodyVelocity=bodyDirection*bodySpeed;this.forceVelocity(bodyVelocity);}}else {var targetSpeed=this.targetVelocity.length();var forward=this.targetVelocity.clone().divScalar(targetSpeed);var right=new Vec2(forward.y,-forward.x);var forwardSpeed=bodyVelocity.dot(forward);var rightSpeed=bodyVelocity.dot(right);forwardSpeed=Utils.moveTowards(forwardSpeed,targetSpeed,this.acceleration*dt);forward.mulScalar(forwardSpeed);right.mulScalar(rightSpeed);forward.add(right);bodyVelocity=Utils.clampMagnitudeVec2(forward,Constants.CHARACTER_MAX_SPEED);this.forceVelocity(bodyVelocity);}}transitionToState(newState,force=false){this.onStateExit(this.state,newState);this.prevState=this.state;this.state=newState;this.onStateEnter(this.state,this.prevState);}onStateEnter(state,prevState){}onStateExit(state,newState){}updateState(dt){switch(this.state){case Character.STATE_MOVE:this.updateMove(dt);break;case Character.STATE_ATTACK:this.updateAttack(dt);break;case Character.STATE_DIE:this.updateDie(dt);break}}updateMove(dt){}updateAttack(dt){}updateDie(dt){}updateDisplay(dt){this.setEnityPosition(Utils.getPosition3D(this.position));this.setEnityRotation(Utils.getRotationFromOrientation(this.orientation));}constructor(...args){super(...args);_define_property$6(this,"radius",1);_define_property$6(this,"mass",1);_define_property$6(this,"speed",10);_define_property$6(this,"acceleration",90);_define_property$6(this,"maxHealth",100);_define_property$6(this,"damage",10);}}_define_property$6(Character,"scriptName","character");(()=>{Character.STATE_MOVE=0;Character.STATE_ATTACK=1;Character.STATE_DIE=2;})();(()=>{Character.TYPE_UNKNOWN=-1;Character.TYPE_PLAYER=0;Character.TYPE_ENEMY=1;})();

var character = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Character: Character
});

function _define_property$5(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Player extends Character{getCharacterType(){return Character.TYPE_PLAYER}postInitialize(){super.postInitialize();Game.instance.setPlayer(this);}initializeCharacter(){super.initializeCharacter();}onStateEnter(state,prevState){if(state==Character.STATE_MOVE){this.updateMoveFromInput();}}updateMove(dt){super.updateMove(dt);this.updateMoveFromInput();}updateMoveFromInput(){var move=Game.getMove();if(Utils.isZeroVec2(move)){this.setTargetVelocity(Vec2.ZERO);}else {this.setTargetVelocityFromDirection(move);this.setOrientationFromDirection(move);}}}_define_property$5(Player,"scriptName","player");

var player = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Player: Player
});

function _define_property$4(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Enemy extends Character{getCharacterType(){return Character.TYPE_ENEMY}initializeCharacter(){super.initializeCharacter();}}_define_property$4(Enemy,"scriptName","enemy");

var enemy = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Enemy: Enemy
});

function _define_property$3(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class Joystick extends Script{initialize(){this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.startPosition=Vec2.ZERO.clone();this.direction=Vec2.ZERO.clone();this.move=Vec2.ZERO.clone();this.app.on(this.touchStartEventName,this.onTouchStart);this.app.on(this.touchEndEventName,this.onTouchEnd);this.app.on(this.touchMoveEventName,this.onTouchMove);this.once("destroy",this.onDestroyed);}onDestroyed(){this.app.off(this.touchStartEventName,this.onTouchStart);this.app.off(this.touchEndEventName,this.onTouchEnd);this.app.off(this.touchMoveEventName,this.onTouchMove);}setPosition(x,y){this.entity.setLocalPosition(x,y,0);}setHandleOffset(x,y){this.handle.setLocalPosition(x,y,0);}setVisible(value){this.entity.element.enabled=value;this.handle.element.enabled=value;}onTouchStart(x,y){this.setVisible(true);this.startPosition.set(x,y);this.setPosition(x,y);this.setHandleOffset(0,0);}onTouchEnd(x,y){this.setVisible(false);this.resetMove();}onTouchMove(x,y){var dx=x-this.startPosition.x;var dy=y-this.startPosition.y;this.updateMove(dx,dy);}resetMove(){this.direction.set(0,0);this.move.set(0,0);this.setHandleOffset(0,0);}updateMove(dx,dy){Utils.clampMagnitudeVec2InPlace(this.direction,dx,dy,this.handleMaxDistance);this.setHandleOffset(this.direction.x,this.direction.y);if(!this.snapping){this.move.set(-this.direction.x/this.handleMaxDistance,this.direction.y/this.handleMaxDistance);}else {this.move.set(-this.direction.x,this.direction.y);Utils.normalizeVec2InPlace(this.move);}}constructor(...args){super(...args);_define_property$3(this,"handle",void 0);_define_property$3(this,"handleMaxDistance",256);_define_property$3(this,"touchStartEventName","touchStart");_define_property$3(this,"touchEndEventName","touchEnd");_define_property$3(this,"touchMoveEventName","touchMove");_define_property$3(this,"snapping",false);}}_define_property$3(Joystick,"scriptName","joystick");

var joystick = /*#__PURE__*/Object.freeze({
    __proto__: null,
    Joystick: Joystick
});

function _define_property$2(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class DesktopInput extends Script{initialize(){this.canvas=this.app.graphicsDevice.canvas;this.onKeyDown=this.onKeyDown.bind(this);this.onKeyUp=this.onKeyUp.bind(this);window.addEventListener("keydown",this.onKeyDown);window.addEventListener("keyup",this.onKeyUp);this.once("destroy",this.onDestroyed);}onDestroyed(){window.removeEventListener("keydown",this.onKeyDown);window.removeEventListener("keyup",this.onKeyUp);}handleKey(key,val){switch(key.toLowerCase()){case"w":case"arrowup":this.app.fire("move:up",val);break;case"s":case"arrowdown":this.app.fire("move:down",val);break;case"a":case"arrowleft":this.app.fire("move:right",val);break;case"d":case"arrowright":this.app.fire("move:left",val);break}}onKeyDown(e){if(e.repeat){return}this.handleKey(e.key,true);}onKeyUp(e){if(e.repeat){return}this.handleKey(e.key,false);}}_define_property$2(DesktopInput,"scriptName","desktopInput");

var desktop_input = /*#__PURE__*/Object.freeze({
    __proto__: null,
    DesktopInput: DesktopInput
});

function _define_property$1(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class MobileInput extends Script{initialize(){this.device=this.app.graphicsDevice;this.canvas=this.app.graphicsDevice.canvas;this.screen=this.screenEntity.screen;this.onTouchStart=this.onTouchStart.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.isTouching=false;this.touchId=0;this.touchPosition=Vec2.ZERO.clone();this.canvas.addEventListener("touchstart",this.onTouchStart,false);this.canvas.addEventListener("touchmove",this.onTouchMove,false);this.canvas.addEventListener("touchend",this.onTouchEnd,false);this.once("destroy",this.onDestroyed);}onDestroyed(){this.canvas.removeEventListener("touchstart",this.onTouchStart,false);this.canvas.removeEventListener("touchmove",this.onTouchMove,false);this.canvas.removeEventListener("touchend",this.onTouchEnd,false);}updateTouchPosition(canvasX,canvasY){var scale=this.screen.scale;var screenWidth=this.device.width/scale;var screenHeight=this.device.height/scale;this.touchPosition.set(screenWidth*canvasX/this.canvas.clientWidth,screenHeight*(1-canvasY/this.canvas.clientHeight));}onTouchStart(e){if(this.isTouching)return;e.preventDefault();var touches=e.changedTouches;var touchCount=touches.length;if(touchCount==0)return;var touch=touches[0];this.isTouching=true;this.touchId=touch.identifier;this.updateTouchPosition(touch.pageX,touch.pageY);this.app.fire("joystick:start",this.touchPosition.x,this.touchPosition.y);}onTouchEnd(e){if(!this.isTouching)return;e.preventDefault();var touches=e.changedTouches;var touchCount=touches.length;if(touchCount==0)return;for(var i=0;i<touchCount;++i){var touch=touches[i];if(touch.identifier!==this.touchId)continue;this.isTouching=false;this.touchId=0;this.updateTouchPosition(touch.pageX,touch.pageY);this.app.fire("joystick:end",this.touchPosition.x,this.touchPosition.y);break}}onTouchMove(e){if(!this.isTouching)return;e.preventDefault();var touches=e.changedTouches;var touchCount=touches.length;if(touchCount==0)return;for(var i=0;i<touchCount;++i){var touch=touches[i];if(touch.identifier!==this.touchId)continue;this.updateTouchPosition(touch.pageX,touch.pageY);this.app.fire("joystick:move",this.touchPosition.x,this.touchPosition.y);break}}update(dt){}constructor(...args){super(...args);_define_property$1(this,"screenEntity",void 0);}}_define_property$1(MobileInput,"scriptName","mobileInput");

var mobile_input = /*#__PURE__*/Object.freeze({
    __proto__: null,
    MobileInput: MobileInput
});

function _define_property(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else {obj[key]=value;}return obj}class GameCamera extends Script{initialize(){this.followCharacter=null;this.position=this.entity.getLocalPosition();this.positionOffset=Vec3.ZERO.clone();}setFollowCharacter(character){this.followCharacter=character;this.positionOffset.copy(this.position);this.positionOffset.sub(this.followCharacter.getEnityPosition());}postUpdate(dt){if(this.followCharacter===null)return;this.position.copy(this.followCharacter.getEnityPosition());this.position.add(this.positionOffset);this.entity.setLocalPosition(this.position);}}_define_property(GameCamera,"scriptName","gameCamera");

var game_camera = /*#__PURE__*/Object.freeze({
    __proto__: null,
    GameCamera: GameCamera
});

export { character as a, box2d_utils as b, constants as c, desktop_input as d, enemy as e, game_camera as f, game as g, joystick as j, mobile_input as m, player as p, shape_type as s, transform2d as t, utils as u };
